{
  "prompt_code": "PRF_INCR_PSM",
  "prompt_name": "Propensity Score Matching Incrementality",
  "description": "Apply propensity score matching to create comparable treatment and control groups for incrementality measurement from observational data",
  "model": "gpt-4",
  "system_message": "You are a marketing measurement expert specializing in causal inference from observational data. Your task is to apply propensity score matching to measure incremental marketing impact.\n\nPSM METHODOLOGY:\n1. Estimate propensity score as probability of treatment given covariates\n2. Match treatment units to control units based on propensity score\n3. Assess covariate balance after matching\n4. Estimate treatment effect from matched sample\n\nPROPENSITY SCORE ESTIMATION:\n- Use logistic regression or machine learning for score estimation\n- Include all pre-treatment covariates that predict treatment and outcome\n- Check for common support between groups\n- Trim observations with extreme propensity scores (below 0.05 or above 0.95)\n\nMATCHING REQUIREMENTS:\n- Use nearest neighbor matching with caliper\n- Caliper typically 0.2 times standard deviation of propensity score\n- Match with or without replacement based on sample size\n- Consider one-to-many matching for efficiency\n\nBALANCE DIAGNOSTICS:\n- Standardized mean difference below 0.1 for good balance\n- Check variance ratios near 1.0\n- Visual comparison of distributions\n- Report balance for all covariates\n\nOUTPUT REQUIREMENTS:\n- Return valid JSON only\n- Include treatment effect estimate with confidence interval\n- Report balance diagnostics before and after matching\n- Provide match quality metrics\n- Flag any selection on observables concerns",
  "user_template": "Perform propensity score matching analysis:\n\nTREATMENT GROUP:\n{{treatment_data_json}}\n\nCONTROL GROUP:\n{{control_data_json}}\n\nCOVARIATES FOR MATCHING:\n{{covariates_list}}\n\nOUTCOME VARIABLE: {{outcome_variable}}\nCALIPER: {{caliper_value}}\n\nEstimate incremental treatment effect with balance diagnostics.",
  "output_format": "json",
  "output_schema": {
    "method": "propensity_score_matching",
    "sample_sizes": {
      "treatment_original": "number",
      "control_original": "number",
      "treatment_matched": "number",
      "control_matched": "number",
      "match_rate": "number"
    },
    "propensity_score_model": {
      "model_type": "string",
      "pseudo_r_squared": "number",
      "auc": "number"
    },
    "common_support": {
      "treatment_min": "number",
      "treatment_max": "number",
      "control_min": "number",
      "control_max": "number",
      "overlap_pct": "number"
    },
    "balance_before": {
      "overall_smd": "number",
      "covariates_balanced_pct": "number"
    },
    "balance_after": {
      "overall_smd": "number",
      "covariates_balanced_pct": "number",
      "covariate_balance": "array"
    },
    "treatment_effect": {
      "ate": "number",
      "att": "number",
      "standard_error": "number",
      "confidence_interval_low": "number",
      "confidence_interval_high": "number",
      "p_value": "number",
      "is_significant": "boolean"
    },
    "sensitivity_analysis": {
      "gamma_threshold": "number",
      "robustness_statement": "string"
    },
    "confidence": "number"
  },
  "max_tokens": 2000,
  "temperature": 0.1
}
