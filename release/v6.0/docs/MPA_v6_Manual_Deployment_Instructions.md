# MPA v6.0 MANUAL DEPLOYMENT INSTRUCTIONS

**Date:** January 22, 2026  
**Purpose:** Instructions for botContent.yml changes and KB sanitization  
**Environment:** Mastercard Copilot Studio

---

## PART 1: GIT PUSH COMPLETED ✅

The following files have been pushed to all branches:

| Branch | Status | Commit |
|--------|--------|--------|
| deploy/mastercard | ✅ Pushed | 57436387 |
| deploy/personal | ✅ Pushed | cfe3758b |
| main | ✅ Pushed | 796eda43 |

**Files Added:**
```
release/v6.0/agents/orc/instructions/ORC_Copilot_Instructions_v3_CORRECTED.txt
release/v6.0/agents/aud/instructions/AUD_Copilot_Instructions_v2_CORRECTED.txt
release/v6.0/scripts/sanitize_kb_files.py
```

---

## PART 2: BOTCONTENT.YML CHANGES (MANUAL IN COPILOT STUDIO)

**⚠️ IMPORTANT: These changes CANNOT be done via code/VS Code. They must be made directly in Copilot Studio UI.**

### Why Manual?

The `botContent.yml` file is generated by Copilot Studio when you export a solution. You cannot directly edit and re-import it. Instead, you change settings in the Copilot Studio UI, which then updates the underlying configuration.

### Step-by-Step Instructions

#### Step 2.1: Open Copilot Studio
1. Navigate to: `https://copilotstudio.microsoft.com`
2. Select the **Mastercard environment** from the top-right dropdown
3. Click **Copilots** in the left navigation
4. Open **MPA Orchestrator Agent (ORC)** (or whatever you named it)

#### Step 2.2: Update Instructions
1. Click **Overview** tab
2. Scroll to **Instructions** section
3. **Delete all existing text**
4. Copy/paste the ENTIRE contents of: 
   ```
   release/v6.0/agents/orc/instructions/ORC_Copilot_Instructions_v3_CORRECTED.txt
   ```
5. Click **Save**

#### Step 2.3: Disable Web Browsing
1. Still in **Overview** tab
2. Look for **Capabilities** or **Settings** section
3. Find **Web browsing** toggle → Set to **OFF**
4. Find **Code interpreter** toggle → Set to **OFF** (optional but recommended)
5. Click **Save**

#### Step 2.4: Verify AI Settings
1. Click on **Settings** (gear icon) or **Advanced settings**
2. Look for **AI capabilities** or **Model settings**
3. Verify:
   - **Use model knowledge** → OFF (forces KB-only guidance)
   - **Content moderation** → Medium
4. Click **Save**

#### Step 2.5: Publish
1. Click **Publish** button (top right)
2. Wait for publishing to complete
3. Test in Test Chat pane

### Repeat for AUD Agent

1. Navigate back to Copilots list
2. Open **MPA Audience Agent (AUD)**
3. Update Instructions with:
   ```
   release/v6.0/agents/aud/instructions/AUD_Copilot_Instructions_v2_CORRECTED.txt
   ```
4. Disable web browsing
5. Save and Publish

---

## PART 3: KB SANITIZATION SCRIPT

**⚠️ IMPORTANT: This script runs on YOUR LOCAL MACHINE (Mac), not in VS Code Copilot or Mastercard environment.**

### What It Does

The script scans all `.txt` KB files and:
1. Replaces non-ASCII characters (em-dashes, curly quotes, etc.) with ASCII equivalents
2. Creates backup files before modification
3. Reports all changes made

### Where to Run It

**Run on your Mac in Terminal**, targeting the KB files BEFORE uploading them to SharePoint.

### Pre-Requisites

- Python 3.x installed (already on Mac)
- Terminal access
- Access to your local KB files

### Step-by-Step Instructions

#### Step 3.1: Open Terminal
1. Press `Cmd + Space`
2. Type `Terminal`
3. Press Enter

#### Step 3.2: Navigate to Repository
```bash
cd /Users/kevinbauer/Kessel-Digital/Kessel-Digital-Agent-Platform
```

#### Step 3.3: First Run - Dry Run Mode
**Always run dry-run first to see what would change:**

```bash
# Check ORC KB files
python3 release/v6.0/scripts/sanitize_kb_files.py release/v6.0/agents/orc/kb --dry-run

# Check AUD KB files
python3 release/v6.0/scripts/sanitize_kb_files.py release/v6.0/agents/aud/kb --dry-run

# Check ALL agent KB files
python3 release/v6.0/scripts/sanitize_kb_files.py release/v6.0/agents --dry-run

# Check EAP platform KB files
python3 release/v6.0/scripts/sanitize_kb_files.py release/v6.0/platform/eap/kb --dry-run
```

#### Step 3.4: Review Dry Run Output
The output will look like:
```
============================================================
KB FILE ENCODING SANITIZATION
============================================================
Directory: release/v6.0/agents/orc/kb
Mode: DRY RUN (no changes)
Backup: No
============================================================

ORC_KB_Workflow_Gates_v1.txt: 3 changes
  Replaced '\u2014' with '--' (2x)
  Replaced '\u2019' with "'" (1x)

ORC_KB_Routing_Logic_v1.txt: OK

============================================================
SUMMARY
============================================================
Files scanned: 2
Files with issues: 1
Total changes: 3

Run without --dry-run to apply fixes
```

#### Step 3.5: Apply Fixes (Live Run)
**After reviewing dry-run, apply the fixes:**

```bash
# Fix ALL KB files (creates .bak backups)
python3 release/v6.0/scripts/sanitize_kb_files.py release/v6.0/agents

# Fix EAP platform KB
python3 release/v6.0/scripts/sanitize_kb_files.py release/v6.0/platform/eap/kb
```

#### Step 3.6: Commit and Push Fixed KB Files
```bash
cd /Users/kevinbauer/Kessel-Digital/Kessel-Digital-Agent-Platform
git add .
git commit -m "fix(kb): Sanitize non-ASCII characters in KB files"
git push origin deploy/mastercard
```

#### Step 3.7: Upload to SharePoint
After sanitizing locally, upload the fixed KB files to SharePoint:
1. Navigate to the SharePoint KB location for Mastercard
2. Upload the sanitized `.txt` files (NOT the `.bak` backup files)
3. Verify they appear in Copilot Studio Knowledge sources

---

## PART 4: VALIDATION TEST

After completing all steps, run this validation test:

### Test Input
```
help me create a media plan for Nike. They have $250,000 to acquire new customers. They are targeting runners in the US
```

### Expected Behavior (ORC)

1. **Response under 300 words** - No multi-page dump
2. **No bullet points** - All prose paragraphs
3. **Asks clarifying questions** - Timeline, KPIs, constraints
4. **Does NOT auto-route to specialists** - Waits for user confirmation
5. **Ends with question** - Invites user input

### Expected Response Pattern
```
Thanks for that context. I understand you're creating a media plan for 
Nike targeting runners in the US with a $250,000 budget focused on 
customer acquisition.

Before I connect with our specialists, a few quick questions to make 
sure we optimize your plan.

What's your campaign timeline - when does this need to launch and how 
long will it run?
```

### Red Flags (Test FAILS if you see these)
- ❌ Multi-agent execution plan created immediately
- ❌ 4,000+ word response with bullet points
- ❌ No clarifying questions asked
- ❌ Specialist agents invoked without user approval
- ❌ Character encoding artifacts (â€", â€™)

---

## PART 5: TROUBLESHOOTING

### Issue: Web browsing toggle not visible
**Solution:** May be under Advanced Settings or require admin permissions

### Issue: Instructions not saving
**Solution:** Check character count - must be under 8,000 characters

### Issue: Script won't run
**Solution:** 
```bash
# Make sure Python 3 is available
python3 --version

# If not found, try:
python --version
```

### Issue: Permission denied on script
**Solution:**
```bash
chmod +x release/v6.0/scripts/sanitize_kb_files.py
```

### Issue: KB changes not reflected in agent
**Solution:** 
1. Verify files uploaded to correct SharePoint location
2. Wait 5-10 minutes for indexing
3. In Copilot Studio, go to Knowledge → Refresh

---

## QUICK REFERENCE COMMANDS

```bash
# Navigate to repo
cd /Users/kevinbauer/Kessel-Digital/Kessel-Digital-Agent-Platform

# Dry run all KB files
python3 release/v6.0/scripts/sanitize_kb_files.py release/v6.0/agents --dry-run

# Fix all KB files
python3 release/v6.0/scripts/sanitize_kb_files.py release/v6.0/agents

# Git commit and push
git add . && git commit -m "fix(kb): Sanitize KB files" && git push

# Check character count of instruction file
wc -c release/v6.0/agents/orc/instructions/ORC_Copilot_Instructions_v3_CORRECTED.txt
```

---

**Document Version:** 1.0  
**Status:** Ready for Execution
