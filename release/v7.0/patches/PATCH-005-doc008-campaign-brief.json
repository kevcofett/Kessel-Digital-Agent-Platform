{
  "patch_id": "PATCH-005",
  "version": "6.0.2",
  "date": "2026-01-19",
  "description": "Fix DOC-008 Campaign Brief generation capability test",
  "affected_tests": ["DOC-008"],
  "priority": "P1",
  "type": "capability_fix",

  "root_cause_analysis": {
    "test_id": "DOC-008",
    "test_name": "Campaign Brief",
    "input": "Create a comprehensive campaign brief for the Q2 launch",
    "expected_flow": "GenerateDocument",
    "expected_output_contains": ["campaign_overview", "objectives", "tactics", "measurement"],
    "failure_reason": "GenerateDocument flow missing campaign brief template - only has media plan and executive summary templates",
    "actual_behavior": "Returns generic document without campaign-specific sections"
  },

  "changes": [
    {
      "file": "agents/doc/templates/campaign-brief-template.json",
      "change_type": "create",
      "description": "Create campaign brief document template",
      "content": {
        "template_id": "CAMPAIGN_BRIEF",
        "template_name": "Campaign Brief",
        "version": "1.0.0",
        "description": "Comprehensive campaign brief for stakeholder alignment",
        "sections": [
          {
            "id": "campaign_overview",
            "title": "Campaign Overview",
            "required": true,
            "fields": [
              {"name": "campaign_name", "type": "text", "required": true},
              {"name": "campaign_period", "type": "date_range", "required": true},
              {"name": "campaign_description", "type": "rich_text", "required": true},
              {"name": "business_context", "type": "rich_text", "required": false}
            ]
          },
          {
            "id": "objectives",
            "title": "Campaign Objectives",
            "required": true,
            "fields": [
              {"name": "primary_objective", "type": "text", "required": true},
              {"name": "secondary_objectives", "type": "array", "required": false},
              {"name": "kpis", "type": "kpi_table", "required": true},
              {"name": "success_criteria", "type": "rich_text", "required": true}
            ]
          },
          {
            "id": "target_audience",
            "title": "Target Audience",
            "required": true,
            "fields": [
              {"name": "primary_audience", "type": "audience_profile", "required": true},
              {"name": "secondary_audiences", "type": "array", "required": false},
              {"name": "audience_insights", "type": "rich_text", "required": false}
            ]
          },
          {
            "id": "tactics",
            "title": "Campaign Tactics",
            "required": true,
            "fields": [
              {"name": "channel_tactics", "type": "channel_table", "required": true},
              {"name": "messaging_approach", "type": "rich_text", "required": true},
              {"name": "creative_requirements", "type": "array", "required": false},
              {"name": "timeline_phases", "type": "timeline", "required": true}
            ]
          },
          {
            "id": "budget",
            "title": "Budget & Resources",
            "required": true,
            "fields": [
              {"name": "total_budget", "type": "currency", "required": true},
              {"name": "budget_allocation", "type": "allocation_table", "required": true},
              {"name": "resource_requirements", "type": "array", "required": false}
            ]
          },
          {
            "id": "measurement",
            "title": "Measurement Framework",
            "required": true,
            "fields": [
              {"name": "measurement_approach", "type": "rich_text", "required": true},
              {"name": "reporting_cadence", "type": "text", "required": true},
              {"name": "optimization_triggers", "type": "array", "required": false},
              {"name": "attribution_model", "type": "text", "required": false}
            ]
          }
        ],
        "output_formats": ["docx", "pdf", "pptx"]
      }
    },
    {
      "file": "agents/doc/flows/GenerateDocument.yaml",
      "section": "document_types",
      "change_type": "update",
      "description": "Register campaign brief template in GenerateDocument flow",
      "content": {
        "document_types": {
          "existing": ["MEDIA_PLAN", "EXECUTIVE_SUMMARY", "CHANNEL_DETAIL", "BUDGET_BREAKDOWN"],
          "add": {
            "CAMPAIGN_BRIEF": {
              "template_file": "templates/campaign-brief-template.json",
              "trigger_phrases": ["campaign brief", "comprehensive brief", "launch brief", "Q1 brief", "Q2 brief", "Q3 brief", "Q4 brief"],
              "required_context": ["campaign_name", "objectives", "budget"],
              "optional_context": ["audience_segments", "channel_allocation", "timeline"]
            }
          }
        }
      }
    }
  ],

  "test_validation": {
    "DOC-008": {
      "name": "Campaign Brief",
      "input": "Create a comprehensive campaign brief for the Q2 launch",
      "expected_flow": "GenerateDocument",
      "expected_output_contains": ["campaign_overview", "objectives", "tactics", "measurement"],
      "fix_rationale": "Added campaign brief template with all required sections"
    }
  },

  "implementation_instructions": [
    "1. Create campaign-brief-template.json in doc/templates",
    "2. Update GenerateDocument flow to include CAMPAIGN_BRIEF document type",
    "3. Re-run test DOC-008 to validate fix"
  ]
}
