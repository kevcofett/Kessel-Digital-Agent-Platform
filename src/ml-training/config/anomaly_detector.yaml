# Anomaly Detection Model Configuration
# PRF Agent - Performance Metric Anomaly Detection

model:
  name: anomaly_detector
  type: anomaly_detection
  algorithm: isolation_forest
  task: unsupervised_anomaly
  
features:
  time_series:
    - metric_value
    - metric_value_lag_1
    - metric_value_lag_7
    - metric_value_lag_14
    - metric_value_lag_28
    - rolling_mean_7d
    - rolling_std_7d
    - rolling_mean_28d
    - rolling_std_28d
    - ewm_mean_7d
    - ewm_std_7d
    
  derived:
    - pct_change_1d
    - pct_change_7d
    - pct_change_28d
    - zscore_7d
    - zscore_28d
    - deviation_from_trend
    - seasonality_residual
    - volatility_7d
    
  contextual:
    - day_of_week
    - day_of_month
    - month
    - quarter
    - is_weekend
    - is_holiday
    - is_campaign_active
    - seasonality_index

target:
  name: is_anomaly
  type: binary
  contamination: auto

preprocessing:
  numerical:
    imputer: interpolate
    interpolate_method: linear
    scaler: robust
    outlier_treatment: none
    
  time_features:
    cyclical_encoding: true
    components:
      - day_of_week
      - month

algorithms:
  isolation_forest:
    n_estimators: 200
    max_samples: auto
    contamination: auto
    max_features: 1.0
    bootstrap: false
    random_state: 42
    n_jobs: -1
    
  local_outlier_factor:
    n_neighbors: 20
    algorithm: auto
    metric: minkowski
    contamination: auto
    novelty: true
    n_jobs: -1
    
  autoencoder:
    encoder_layers: [64, 32, 16]
    decoder_layers: [16, 32, 64]
    latent_dim: 8
    activation: relu
    dropout: 0.2
    epochs: 100
    batch_size: 32
    learning_rate: 0.001
    
ensemble:
  enabled: true
  method: voting
  algorithms:
    - isolation_forest
    - local_outlier_factor
  weights: [0.6, 0.4]
  threshold: 0.5

tuning:
  method: grid_search
  param_grid:
    isolation_forest:
      n_estimators: [100, 200, 300]
      max_samples: [0.5, 0.8, 1.0]
      contamination: [0.01, 0.05, 0.1]
    local_outlier_factor:
      n_neighbors: [10, 20, 30, 50]
      contamination: [0.01, 0.05, 0.1]

training:
  validation_method: temporal_split
  train_ratio: 0.7
  validation_ratio: 0.15
  test_ratio: 0.15
  
evaluation:
  primary_metric: f1
  threshold_selection: precision_recall_balance
  metrics:
    - precision
    - recall
    - f1
    - auc_roc
    - average_precision
  threshold_metrics:
    precision: 0.70
    recall: 0.80
    f1: 0.70

sensitivity:
  levels:
    low:
      contamination: 0.15
      threshold: 0.3
    medium:
      contamination: 0.10
      threshold: 0.5
    high:
      contamination: 0.05
      threshold: 0.7
    critical:
      contamination: 0.02
      threshold: 0.9
      
inference:
  batch_size: 1000
  timeout_ms: 100
  min_history_points: 28
  
output:
  predictions:
    - is_anomaly
    - anomaly_score
    - anomaly_type
    - expected_value
    - deviation
    - confidence
  summary:
    - total_anomalies
    - critical_count
    - warning_count
    - baseline
